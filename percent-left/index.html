<!DOCTYPE html>
<html lang='en'>
<head>
	<meta charset='UTF-8'>
	<meta name='viewport' content='width=device-width, initial-scale=1.0'>
	<meta name="description" content="2027年まであと何%なのかを表示します。他の年も設定できます。">

		<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-G3VRHWGPB7"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'G-G3VRHWGPB7');
	</script>

	<!-- Color picker:
		I used Pickr(https://github.com/Simonwep/pickr?tab=readme-ov-file).
		A big thank you to simonwep. -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@simonwep/pickr@1.8.2/dist/themes/monolith.min.css">
	<script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr@1.8.2/dist/pickr.min.js"></script>

	<title>2027年まであと何%？</title>
	<style>
		@font-face {
			font-family: "originalFont";
			src: url(/0_data/fonts/MPLUS1p-Regular.ttf) format("truetype");
			/* src: url(https://u-12031.github.io//0_data/fonts/MPLUS1p-Regular.ttf); */
			/* ↑codeswing用 */
		}

		@font-face {
			font-family: "7segFont";
			src: url(/0_data/fonts/fonts-DSEG_v046/DSEG7ClassicMini-Bold.ttf) format("truetype");
			src: url(https://u-12031.github.io//0_data/fonts/fonts-DSEG_v046/DSEG7ClassicMini-Bold.ttf);
			/* ↑codeswing用 */
		}

		* {
			text-align: center;
			font-family: "originalFont";
		}

		body {margin: 0;}

		ul {list-style: none;}

		li {
			border-image-width: 0 0 0 2px;
			border-image-slice: 0 0 0 100%;
			border-image-outset: 1 1 1 10px;
			border-image-source: linear-gradient(to bottom, transparent 2.3em, #777 2.3em);
		}

		.listTitle {
			display:inline-block;
			margin-top: 10px;
			margin-bottom: 5px;
			margin-left: -20px;
			font-size: 17px;
		}

		input[type="checkbox"] {
			appearance: none;
			position: relative;
			margin: 5px auto;
			margin-bottom: -5px;
			width: 38px;
			height: 20px;
			border-radius: 12.5px;
			background-color: #999;
			transition: all .15s;
				
			&:checked {background-color: #0af;}

			&::after {
				margin: 0;
				content: "";
				position: absolute;
				top: 1px;
				left: 1px;
				width: 18px;
				height: 18px;
				border-radius: 50%;
				background-color: #fff;
				transition: all .15s;
			}

			&:checked::after {left: 19px;}
		}

		.pickr {
			display: inline-block;
			margin: 5px;
			transition: opacity .5s;
		}

		#title>#timeFor {
			font-size: inherit;
			padding: 0;
			padding-right: 5px;
			margin-right: -5px;
		}

		#outputParent {
			position: relative;
			width: calc(100vw - 50px);
			margin: 150px 25px;
			height: 80px;
			border: 2px solid #333;
		}

		#outputParent>#outputSquare {
			position:absolute;
			top: 10px;
			left: 10px;
			width: calc(100vw - 70px); /* 初期値として */
			height: 60px;
			background-color: #0f0;
		}

		#outputParent>#outputPercent {
			font-family: "7segFont", monospace;
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			font-size: 1.5em;
		}

		#settings {
			text-align: left;
			position: relative;
			display: grid;
			grid-template-columns: 1fr 1fr;
			background-color: #cef;
			margin: auto 30px;
			padding: 20px 30px;
			border: none;
			border-radius: 15px;
			line-height: 1.3em;
		}

		#settings * {text-align: left;}

		#settings>legend {
			position: absolute;
			top: 0;
			left: 15px;
			translate: 0 -50%;
			background-color: #adf;
			padding: 7px 10px;
			border-radius: 7px;
			font-size: 20px;
		}

		#settings input:not([type="checkbox"]) {
			margin: 5px 10px;
			padding: 0;
			font-size: 0.9em;
		}

		#settings *:not(input) {cursor: default;}

		#maxColorParent {
			display: inline-block;
			transition: translate .5s cubic-bezier(0, 0.6, 0.5, 1);
		}

		#interval, #decimalPlace {
			margin-right: 0;
			margin-bottom: 0;
			width: 50px;
		}

		#settings #displaySize {
			position: relative;
			width: 200px;
			translate: 0 2px;
			margin-bottom: 20px;

			&::after {
				content: "";
				position: absolute;
				top: 19px;
				left: 44px;
				display: inline-block;
				width: 2px;
				height: 10px;
				background-color: #333;
			}
		}

		#doUseOriginalFont {
			background-color: #0af;
			height: 6px;
			translate: 0 -7px;

			&::after {top: -6px;}
		}

		#useOriginalFont {color: #0af;} /*  */
	</style>
</head>
<body>
	<h1 id="title">
		<select id="timeFor">
			<option value="0">来年</option>
			<option value="1">来月</option>
			<option value="2">明日</option>
			<option value="3">次の時間</option>
			<option value="4">次の分</option>
			<option value="5">次の秒</option>
		</select>
		まであと
	</h1>
	<div id="outputParent">
		<div id="outputSquare"></div>
		<span id="outputPercent"></span>
	</div>
	<fieldset id="settings">
		<legend>設定</legend>
		<ul>
			<li><span class="listTitle">色の変化</span><br>
				<label>中央の色を使う
					<input type="checkbox" id="doUseMiddleColor" checked>
				</label>
				<br>
				<span class="pickr" id="minColor" data-color="#f00"></span>
				＜
				<span class="pickr" id="middleColor" data-color="#ff0"></span>
				<span id="maxColorParent">
					＜
					<span class="pickr" id="maxColor" data-color="#0f0"></span>
				</span>
			</li>
			<li><label class="listTitle" for="interval">更新する間隔</label>
				<br>
				<input type="number" id="interval" min="0" value="1000">
				<span style="white-space: nowrap;">ミリ秒</span>
			</li>
		</ul>
		<ul>
			<li><label class="listTitle" for="displaySize">文字の大きさ</label>
				<br>
				<label>文字を表示する
					<input type="checkbox" id="doDisplayText" checked>
				</label>
				<input type="range" id="displaySize" min="0" max="5" step="0.1" value="1">
				<span id="displaySizeOutput">×1.0</span>
			</li>
			<li><label class="listTitle" for="decimalPlace">小数点以下の桁数</label>
				<br>
				<input type="number" id="decimalPlace" min="0" value="2">
				桁
			</li>
			<li><span class="listTitle">フォントの種類</span>
				<br>
				<span id="useNormalFont">ブラウザのフォント</span>
				<input type="checkbox" id="doUseOriginalFont" checked>
				<span id="useOriginalFont">独自のフォント</span>
			</li>
		</ul>
	</fieldset>
	<script>
		/** idから要素を取得します。
		 * @param {string} id 要素のID
		 * @return {HTMLElement} 取得された要素
		 */
		function el(id) {return document.getElementById(id)};
		/** 新しいPickrを作成します。
		 * @class
		 * @param {string} id Pickrを設置する要素のID
		 * @param {string} defaultColor Pickrの初期色
		 * @param {boolean} opacity 透明度バーを表示するかどうか
		 * @return {Pickr} 作成されたPickrオブジェクト
		 */
		function PickrClass(id, defaultColor, opacity=false) {
			const newPickr = Pickr.create({
				el: "#" + id,
				theme: "monolith",
				default: defaultColor,
				swatches: [
					"#000000",
					"#ffffff",
					"#ff0000",
					"#00ff00",
					"#0000ff",
					"#ffff00",
					"#00ffff",
					"#ff00ff"
				],
				components: {
					// 主要なパネル部分
					preview: true,  // 色プレビュー
					opacity: opacity, // 透明度バー
					hue: true,      // 色相バー

					// 下部の入力・操作部分
					interaction: {
						hex: true,    // HEX形式表示
						rgba: true,   // RGBA形式表示
						input: true,  // 入力ボックス
						clear: false, // クリアボタン
						save: true    // 保存ボタン
					}
				}
			});
			newPickr.on("hide", instance => instance.applyColor());
			return newPickr;
		};

		let pickrs = {};

		document.querySelectorAll(".pickr").forEach((el) => {
			pickrs[el.id] = new PickrClass(el.id, el.dataset.color);
			pickrs[el.id].on("change", (color, instance) => {
				percentUpdate();
			});
		});

		// 	ここまでPickr関連のコード

		let now = [ // 今の時間(nowUpdate関数で更新する)
			null, // year
			null, // month
			null, // day
			null, // hour
			null, // minute
			null, // second
			null  // millisecond
		];
		const CARRY_VALUE = [ // 秒を分に、時間を日に繰り上げるときの引く数
			null,
			12,
			null, // 月によって変わるので別で計算する
			24,
			60,
			60,
			1000
		];
		let updateInterval = 1000; // 更新間隔 (ms)
		let update;
		updateUpdate();

		/** 2つの色を指定した比率で混ぜた色を返します。
		 * @param {string(rgb)} color1 色1 (例: "rgb(255, 0, 0)")
		 * @param {string(rgb)} color2 色2 (例: "rgb(0, 0, 255)")
		 * @param {number(0~1)} ratio 色1の比率
		 * @return {string(rgb)} 混ぜた色 (例: "rgb(127, 0, 127)")
		 */
		function colorBlend(color1="rgb(,,)", color2="rgb(,,)", ratio) {
			const result = [];
			color1 = color1.split("(")[1].split(")")[0].split(",").map(Number);
			color2 = color2.split("(")[1].split(")")[0].split(",").map(Number);
			for(let i=0;i<3;i++) {
				result[i] = color1[i] * ratio + color2[i] * (1-ratio);
			};
			return `rgb(${result[0]}, ${result[1]}, ${result[2]})`;
		};

		function squareUpdate(percent) {
			const square = el("outputSquare");
			const doUseMiddleColor = el("doUseMiddleColor").checked;
			square.style.width = `calc((100vw - 70px) * ${percent})`;
			el("outputPercent").textContent = `${(percent*100).toFixed(2)}%`;
			if(doUseMiddleColor) {
				if(percent < 0.5) {
						el("outputSquare").style.backgroundColor = colorBlend(
						pickrs.middleColor.getColor().toRGBA().toString(),
						pickrs.minColor.getColor().toRGBA().toString(),
						percent * 2
					);
				} else {
					el("outputSquare").style.backgroundColor = colorBlend(
						pickrs.maxColor.getColor().toRGBA().toString(),
						pickrs.middleColor.getColor().toRGBA().toString(),
						(percent - 0.5) * 2
					);
				};
			} else {
				el("outputSquare").style.backgroundColor =  colorBlend(
					pickrs.maxColor.getColor().toRGBA().toString(),
					pickrs.minColor.getColor().toRGBA().toString(),
					percent
				)
			};
		};

		function nowUpdate() {
			const acquiredDate = new Date();
			now[0] = acquiredDate.getFullYear();
			now[1] = acquiredDate.getMonth() + 1;
			now[2] = acquiredDate.getDate();
			now[3] = acquiredDate.getHours();
			now[4] = acquiredDate.getMinutes();
			now[5] = acquiredDate.getSeconds();
			now[6] = acquiredDate.getMilliseconds();
		};

		function percentUpdate() {
			const timeFor = Number(el("timeFor").value) + 1;
			const timeForM6 = 6 - timeFor;
			nowUpdate();
			for(let i=0;i<timeForM6;i++) {
				now[5-i] += now[6-i]/CARRY_VALUE[6-i];
			};
			now[timeFor] /= CARRY_VALUE[timeFor]; // "/="なんか中々使わない
			now[timeFor] = 1 - now[timeFor];
			squareUpdate(now[timeFor]);
		};

		function updateUpdate() {
			update = setInterval(percentUpdate, updateInterval);
		};

		el("doUseMiddleColor").oninput = function() {
			const middleColor = document.querySelectorAll(".pickr")[1];
			const maxColorParent = el("maxColorParent");
			if(this.checked) {
				middleColor.style.opacity = "1";
				maxColorParent.style.translate = "0";
			} else {
				middleColor.style.opacity = "0";
				maxColorParent.style.translate = "-62px";
			};
			percentUpdate();
		};

		el("interval").oninput = function() {
			console.log("Interval changed to " + this.value + " ms");
			updateInterval = this.value;
			clearInterval(update);
			updateUpdate();
			percentUpdate();
		};

		el("doDisplayText").oninput = function() {
			if(this.checked) {
				if(el("displaySize").value == "0") {
					el("displaySize").value = 1;
					el("outputPercent").style.fontSize = "1.5em";
					el("displaySizeOutput").innerHTML = "×1.0";
				};
			} else {
				el("displaySize").value = 0;
				el("outputPercent").style.fontSize = "0";
				el("displaySizeOutput").innerHTML = "×0.0";
			};
			percentUpdate();
		};

		el("displaySize").oninput = function() {
			el("outputPercent").style.fontSize = (1.5 * Number(this.value)) + "em";
			el("displaySizeOutput").innerHTML = "×" + Number(this.value).toFixed(1)
			el("doDisplayText").checked = (this.value != "0");
			percentUpdate();
		};

		el("decimalPlace").oninput = function() {
			percentUpdate();
		};

		el("doUseOriginalFont").oninput = function() {
			if(this.checked) {
				el("outputPercent").style.fontFamily = '"7segFont", monospace';
				el("useNormalFont").style.color = "black";
				el("useOriginalFont").style.color = "#0af";
			} else {
				el("outputPercent").style.fontFamily = "monospace";
				el("useNormalFont").style.color = "#0af";
				el("useOriginalFont").style.color = "black";
			};
		};

		el("useNormalFont").onclick = function() {
			el("doUseOriginalFont").checked = false;
			el("outputPercent").style.fontFamily = "monospace";
			el("useNormalFont").style.color = "#0af";
			el("useOriginalFont").style.color = "black";
		};

		el("useOriginalFont").onclick = function() {
			el("doUseOriginalFont").checked = true;
			el("outputPercent").style.fontFamily = '"7segFont" monospace';
			el("useNormalFont").style.color = "black";
			el("useOriginalFont").style.color = "#0af"
		};
	</script>
</body>
</html>