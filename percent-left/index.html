<!DOCTYPE html>
<html lang='en'>
<head>
	<meta charset='UTF-8'>
	<meta name='viewport' content='width=device-width, initial-scale=1.0'>
	<meta name="description" content="2027年まであと何%なのかを表示します。他の年も設定できます。">
	<title>Document</title>

		<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-G3VRHWGPB7"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'G-G3VRHWGPB7');
	</script>

	<!-- Color picker:
		I used Pickr(https://github.com/Simonwep/pickr?tab=readme-ov-file).
		A big thank you to simonwep. -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@simonwep/pickr@1.8.2/dist/themes/monolith.min.css">
	<script src="https://cdn.jsdelivr.net/npm/@simonwep/pickr@1.8.2/dist/pickr.min.js"></script>

	<title>2027年まであと何%？</title>
	<style>
		@font-face {
			font-family: "originalFont";
			src: url(/0_data/fonts/MPLUS1p-Regular.ttf) format("truetype");
			/* src: url(https://u-12031.github.io//0_data/fonts/MPLUS1p-Regular.ttf); */
			/* ↑codeswing用 */
		}

		@font-face {
			font-family: "7segFont";
			src: url(/0_data/fonts/fonts-DSEG_v046/DSEG7ClassicMini-Bold.ttf) format("truetype");
			/* src: url(https://u-12031.github.io//0_data/fonts/fonts-DSEG_v046/DSEG7ClassicMini-Bold.ttf); */
			/* ↑codeswing用 */
		}

		* {
			text-align: center;
			font-family: "originalFont";
		}

		body {
			margin: 0;
		}

		#title>#yearFor {
			font-size: inherit;
			width: 2.75em;
			padding: 0;
			padding-right: 5px;
			margin-right: -5px;
		}

		#outputParent {
			position: relative;
			width: calc(100vw - 50px);
			margin: 150px 25px;
			height: 80px;
			border: 2px solid #333;
		}

		#outputParent>#outputSquare {
			position:absolute;
			top: 10px;
			left: 10px;
			width: calc(100vw - 70px); /* 初期値として */
			height: 60px;
			background-color: #0f0;
		}

		#outputParent>#outputPercent {
			font-family: "7segFont", monospace;
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			font-size: 1.5em;
		}
		.pickr {
			display: inline-block;
		}
	</style>
</head>
<body>
	<h1 id="title">
		<input type="number" id="yearFor" value="2027" min="0">
		年まであと
	</h1>
	<div id="outputParent">
		<div id="outputSquare"></div>
		<span id="outputPercent">100.00%</span>
	</div>
	test<input id="testInput" type="range" min="0" max="100" value="100" step="0.01" style="width: 400px;">
	<br>
	<span id="minColor"></span>
	←→
	<span id="middleColor"></span>
	←→
	<span id="maxColor"></span>
	<script>
		/** idから要素を取得します。
		 * @param {string} id 要素のID
		 * @return {HTMLElement} 取得された要素
		 */
		function el(id) {return document.getElementById(id)};
		/** 新しいPickrを作成します。
		 * @class
		 * @param {string} id Pickrを設置する要素のID
		 * @param {string} defaultColor Pickrの初期色
		 * @param {boolean} opacity 透明度バーを表示するかどうか
		 * @return {Pickr} 作成されたPickrオブジェクト
		 */
		function PickrClass(id, defaultColor, opacity=false) {
			const newPickr = Pickr.create({
				el: "#" + id,
				theme: "monolith",
				default: defaultColor,
				swatches: [
					"#000000",
					"#ffffff",
					"#ff0000",
					"#00ff00",
					"#0000ff",
					"#ffff00",
					"#00ffff",
					"#ff00ff"
				],
				components: {
					// 主要なパネル部分
					preview: true,  // 色プレビュー
					opacity: opacity, // 透明度バー
					hue: true,      // 色相バー

					// 下部の入力・操作部分
					interaction: {
						hex: true,    // HEX形式表示
						rgba: true,   // RGBA形式表示
						input: true,  // 入力ボックス
						clear: false, // クリアボタン
						save: true    // 保存ボタン
					}
				}
			});
			newPickr.on("hide", instance => instance.applyColor());
			return newPickr;
		};
		const PICKR = {
			minColor: new PickrClass("minColor", "#f00"),
			middleColor: new PickrClass("middleColor", "#ff0"),
			maxColor: new PickrClass("maxColor", "#0f0")
		};

		// PICKR.fontColor.on("change", (color, instance) => {
			// const rgbaColor = color.toRGBA().toString();
		// });

		
		// 	ここまでPickr関連のコード

		/** 2つの色を指定した比率で混ぜた色を返します。
		 * @param {string(rgb)} color1 色1 (例: "rgb(255, 0, 0)")
		 * @param {string(rgb)} color2 色2 (例: "rgb(0, 0, 255)")
		 * @param {number(0~1)} ratio 色1の比率
		 * @return {string(rgb)} 混ぜた色 (例: "rgb(127, 0, 127)")
		 */
		function colorBlend(color1="rgb(,,)", color2="rgb(,,)", ratio) {
			const result = [];
			color1 = color1.split("(")[1].split(")")[0].split(",").map(Number);
			color2 = color2.split("(")[1].split(")")[0].split(",").map(Number);
			for(let i=0;i<3;i++) {
				result[i] = color1[i] * ratio + color2[i] * (1-ratio);
			};
			return `rgb(${result[0]}, ${result[1]}, ${result[2]})`;
		};

		function updateSquare() { // テスト段階
			const square = el("outputSquare");
			const percent = el("testInput").value;
			square.style.width = `calc((100vw - 70px) * ${percent} / 100)`;
			el("outputPercent").textContent = `${Number(percent).toFixed(2)}%`;
			if(percent < 50) {
				el("outputSquare").style.backgroundColor = colorBlend(
					PICKR.middleColor.getColor().toRGBA().toString(),
					PICKR.minColor.getColor().toRGBA().toString(),
					percent / 50
				);
			} else {
				el("outputSquare").style.backgroundColor = colorBlend(
					PICKR.maxColor.getColor().toRGBA().toString(),
					PICKR.middleColor.getColor().toRGBA().toString(),
					(percent - 50) / 50
				);
			}
		};

		el("testInput").addEventListener("input", () => {
			updateSquare();
		});
	</script>
</body>
</html>