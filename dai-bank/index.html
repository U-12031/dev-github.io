<!DOCTYPE html>
<html lang="jp">
<head>
	<meta charset="UTF-8">

	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-G3VRHWGPB7"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'G-G3VRHWGPB7');
	</script>

	<title>大銀行(仮)</title>
	<style>
		@font-face {
			font-family: "originalFont";
			src: url(/0_data/fonts/MPLUS1p-Regular.ttf) format("truetype");
		}

		* {
			text-align: center;
			font-family: "originalFont", sans-serif;
		}

		#title>span {font-size: 0.75em;}

		body {background-color: #eff;}
	</style>
</head>
<body>
	<h1 id="title">大銀行<span>(仮)</span></h1>
	<p>version test-β</p>

	<div id="testBts" style="background-color: #fff;">
		name="<input id="testName">", password="<input id="testPassword">"
		<button onclick="addData('test',{name:el('testName').value, password:el('testPassword').value})">データ追加</button>
		<button onclick="getData()">データ取得</button>
	</div>
	<script type="module">
		// Firebase App & Firestore をインポート（すべて同じバージョンで統一）
			import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
			import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
			import {
				getFirestore,
				collection,
				addDoc,
				getDocs
			} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

			const firebaseConfig = {
				apiKey: "AIzaSyAjavOCdQ3RN8atXMLjhLK7TfKY3KSRjig",
				authDomain: "dai-bank.firebaseapp.com",
				projectId: "dai-bank",
				storageBucket: "dai-bank.firebasestorage.app",
				messagingSenderId: "257888747834",
				appId: "1:257888747834:web:e0df926bcf298623325003",
				measurementId: "G-SWPVQD3XT7"
			};

			const app = initializeApp(firebaseConfig);
			const analytics = getAnalytics(app);
			const db = getFirestore(app);

			// データを追加する関数
			async function addData(collectionName, data) {
				try {
					await addDoc(collection(db, collectionName), data);
					alert("書き込み完了！");
				} catch (error) {
					alert(`${error.name}\n${error.stack}`);
				}
			}

			// データを取得する関数
			async function getData() {
				try {
					let result = [];
					const querySnapshot = await getDocs(collection(db, "test"));
					querySnapshot.forEach((doc) => {
						result.push(doc.data());
						alert(`${doc.id}\n${doc.data()}\n${typeof doc.data()}`);
					});
					alert(result);
					return result;
				} catch (error) {
					alert(`${error.name}\n${error.stack}`);
				}
			}

			// 外から呼べるようにする
			window.addData = addData;
			window.getData = getData;
	</script>
	<script>
		function el(id) {return document.getElementById(id);}

		function saveCokie(name, value) {
			document.cookie = `${name}=${value}; max-age=${60*60*24*365};`;
		};

		function getCookie(name) {
			const cookies = document.cookie.split("; ");
			for (const c of cookies) {
				const [key, value] = c.split("=");
				if (key === name) {
					return value;
				};
			};
			return null;
		};
	</script>
</body>
</html>